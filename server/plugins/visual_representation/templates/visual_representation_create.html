{% include 'header.html' %}
    <!-- Our application root element -->
    <div id="app">
      <b-container align-h="center" fluid>
        <b-jumbotron header-level="4" header="{{plugin_name}} Create" lead="Create user study.">
            Specify parameter values.
        </b-jumbotron>
          <b-row align-h="center" class="mb-3">
            <b-col cols="8">
              <b-input type="text" id="prolific_code" name="prolific_code" placeholder="Please enter prolific code (if needed)"/>
            </b-col>
          </b-row>
          <b-row align-h="center">
            <b-col cols="8" class="text-right" align-h="end">
              <b-btn variant="warning" v-on:click="cancelCreateUserStudy">Cancel</b-btn>
              <b-btn variant="primary" v-on:click="onCreateUserStudy">Create</b-btn>
            </b-col>
          </b-row>
      </b-container>
    </div>

    <!-- Start running your app -->
    <script>
      window.app = new Vue({
        el: '#app',
        delimiters: ['[[',']]'], // Used to replace double { escaping with double [ escaping (to prevent jinja vs vue inference)
        data: function() {
            return {
            }
        },
        methods: {
            async onCreateUserStudy() {
                let pluginName = "{{plugin_name}}";
                console.log("Creating user study for plugin: " + pluginName);
                //let k = document.getElementById("k").value;
                let prolific_code = document.getElementById("prolific_code").value;

                let userStudyConfiguration = {
                    "prolific_code": prolific_code
                };

                let userStudyData = {
                    "parent_plugin": pluginName,
                    "config": userStudyConfiguration
                };

                let res = await fetch("/create-user-study",
                    {
                        method: "POST",
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token() }}'
                        },
                        body: JSON.stringify(userStudyData),
                        redirect: "follow"
                    }
                ).then(response => {
                    if (response.redirected) {
                        console.log(response);
                        window.location.href = response.url;
                    } else {
                        return response.text()
                    }
                });
                console.log(res);
            },
            
            cancelCreateUserStudy() {
                window.location.href = "{{ url_for('main.administration') }}"
            }
        }
      })
    </script>
{% include 'footer.html' %}