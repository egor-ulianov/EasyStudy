{% include 'header.html' %}
    <!-- Our application root element -->
    <style>
      div.selected {
        outline: 5px solid greenyellow;
        outline-offset: -5px;
      }

      .theImage {
        outline: 2px solid grey;
      }

      .myContainer {
        width: 100%; /* Set the desired width of the container */
        overflow-x: scroll; /* Enable horizontal scrolling for the container */
        white-space: nowrap; /* Prevent rows from wrapping to the next line */
        position: relative;
      }

      .myRow {
        display: inline-block; /* Display rows in a horizontal line */
        width: 100%; /* Set the desired width for each row */
      }


      .centered-content {
        position: sticky;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        z-index: 1;
        background-color: white;
        width: max-content;
      }

    </style>
    <div id="app">
      <b-container align-h="center" fluid>
        
        {% if comparison_hint_override is defined and comparison_hint_override is not none  %}
        <div class="jumbotron smallJumbotron">
            {{ comparison_hint_override | safe }}
            <h5>({{iteration + 1}}/{{n_iterations}})</h5>
        </div>
        {% else %}
        <b-jumbotron class="smallJumbotron" header="{{header}} ({{iteration + 1}}/{{n_iterations}})" lead="{{hint_lead}}" header-level="4">
            {{hint}}
            <strong>{{note}}:</strong> {{note_text}}
        </b-jumbotron>
        {% endif %}

        <div class="myContainer">
          <b-row align-h="center" class="mt-1 mb-1">
            <b-col class="text-center">
              <b-col class="centered-content">
                <h5>Input</h5>
              </b-col>
            </b-col>
          </b-row>
          <b-row align-h="center">
            <b-col align-h="center" style="text-align: center;" cols="auto" class="text-center align-middle">
                <!-- <b-img src="{{emit_assets('visualrepresentation', filename='img/red.png')}}"/> -->
                {% if iteration_data['method'] == 'table-t' %}
                  <!-- <div style="overflow-x: auto; scroll-snap-type: x mandatory; white-space: nowrap; display: flex; flex-wrap: nowrap; align-items: center; width: 100%; text-align: center;"> -->
                    <div id="sourceDiv"></div>
                  <!-- </div> -->
                
                    <!-- <object style="width: 100%; display: block; justify-content: center;" height="85px;" :data="data.example.rel_path"></object> -->
                {% else %}
                    <b-img height="308px" class="theImage" :src="data.example.rel_path"/>
                {% endif %}
            </b-col>
          </b-row>
          <b-row align-h="center" class="mt-1 mb-1">
            <b-col class="text-center">
              <b-col class="centered-content">
                <h5>Classes</h5>
              </b-col>
            </b-col>
          </b-row>
          {% if iteration_data['method'] == 'table-t' %}
          <b-row v-for="shown_class in data.shown_classes" align-h="center" class="text-center">
              <div class="myRow">
                <div :id="data.method + '_' + data.dataset + '_' + shown_class.name" style="padding-left: 15px; padding-right: 15px; z-index: 1; position: relative; display: inline-block;" @click="onSelectVisualization($event, shown_class)">
                  <div :id="data.method + '_' + data.dataset + '_' + shown_class.name + '_table'" style="position: relative; z-index: -1; display: inline-block;"></div>
                </div>
                
              </div>
            </b-row>
          

          {% else %}
          <b-row>
            <b-col v-for="shown_class in data.shown_classes" align-h="center" class="text-center">
                <b-img height="308px" class="theImage" :id="data.method + '_' + data.dataset + '_' + shown_class.name" @click="onSelectVisualization($event, shown_class)" :src="shown_class.class_image_rel_path"/>
            </b-col>
          </b-row>
          {% endif %}

          <b-row align-h="center" class="mt-1 mb-1">
            <b-col class="text-center">
              <b-col class="centered-content">
                {% if iteration < n_iterations - 1 %}
                <b-form action="{{ continuation_url }}" method="GET">
                    <input type="hidden" hidden="true" :value="selectedItem.method" name="method"/>
                    <input type="hidden" hidden="true" :value="selectedItem.dataset" name="dataset"/>
                    <input type="hidden" hidden="true" :value="selectedItem.id" name="selection_id"/>
                    <input type="hidden" hidden="true" :value="selectedItem.className" name="class_name"/>
                    <input type="hidden" hidden="true" :value="selectedItem.example.name" name="example_name"/>
                    <input type="hidden" hidden="true" :value="selectedItem.example.example_class_name" name="example_class_name"/>
                    <b-btn type="submit" variant="primary" block :disabled="selectedItem.id == null">Continue</b-btn>
                </b-form>
                {% else %}
                <b-form action="{{ continuation_url }}" method="GET">
                    <input type="hidden" hidden="true" :value="selectedItem.method" name="method"/>
                    <input type="hidden" hidden="true" :value="selectedItem.dataset" name="dataset"/>
                    <input type="hidden" hidden="true" :value="selectedItem.id" name="selection_id"/>
                    <input type="hidden" hidden="true" :value="selectedItem.className" name="class_name"/>
                    <input type="hidden" hidden="true" :value="selectedItem.example.name" name="example_name"/>
                    <input type="hidden" hidden="true" :value="selectedItem.example.example_class_name" name="example_class_name"/>
                    <b-btn type="submit" variant="success" block :disabled="selectedItem.id == null">Finish</b-btn>
                </b-form>
                {% endif %}
              </b-col>
            </b-col>
          </b-row>
        </div>

        
      </b-container>
    </div>

    <script src="{{url_for('static', filename='interaction_reporting.js')}}"></script>

    <!-- Start running your app -->
    <script>
      var csrfToken = "{{csrf_token()}}";
      var data = JSON.parse('{{ iteration_data | tojson | safe}}');
      //console.log(data);

      
      window.app = new Vue({
        el: '#app',
        delimiters: ['[[',']]'], // Used to replace double { escaping with double [ escaping (to prevent jinja vs vue inference)
        data: function() {
            return {
                selectedItem: {
                    className: null,
                    id: null,
                    dataset: data.dataset,
                    method: data.method,
                    example: data.example
                },
                data: data
            }
        },
        methods: {
            onSelectVisualization(event, shownClass) {
                //console.log("Selected visualization");
                //console.log(event.srcElement.id);
                //console.log(data.method, data.dataset, shownClass.name);

                let oldSelection = this.selectedItem;
                if (shownClass.name != oldSelection.className) {
                    event.srcElement.classList.add("selected");
                    if (oldSelection.id != null) {
                        document.getElementById(oldSelection.id).classList.remove("selected");
                    }
                }
                this.selectedItem.id = event.srcElement.id;
                this.selectedItem.className = shownClass.name;

                //reportSelectedItem(`/utils/selected-item`, csrfToken, item, this.selected, ()=>{ return {"variant": variant}; });
                reportOnInput("/utils/on-input", csrfToken, "visualization", {
                    "variant": this.selectedItem,
                    "old_variant": oldSelection
                    //"variant_name": this.variantNames[visualizationIndex],
                });
            }
        },
        async mounted() {
            document.getElementById("sourceDiv").innerHTML = await fetch(`{{url_for('visualrepresentation.table_data_example')}}?name=${data.example.name}`).then(resp => resp.text()).catch(err => null);
            for (idx in this.data.shown_classes) {
              let d = this.data.shown_classes[idx];
              document.getElementById(data.method + '_' + data.dataset + '_' + d.name + '_table').innerHTML = await fetch(`{{url_for('visualrepresentation.table_data')}}?name=${d.name}`).then(resp => resp.text()).catch(err => null);
            }
          },
      })
    </script>
{% if footer_override is defined and footer_override is not none %}
<div class="footerDiv mt-3">
  {{ footer_override|safe }}
</div>
</body>
</html>
{% else %}
{% include 'footer.html' %}
{% endif %}