{% include 'header.html' %}
    <!-- Our application root element -->
    <style>
      div.selected {
        outline: 5px solid greenyellow;
        outline-offset: -5px;
      }
    </style>
    <div id="app">
      <b-container align-h="center" fluid>
        
        {% if comparison_hint_override is defined and comparison_hint_override is not none  %}
        <div class="jumbotron smallJumbotron">
            {{ comparison_hint_override | safe }}
            <h5>({{iteration + 1}}/{{n_iterations}})</h5>
        </div>
        {% else %}
        <b-jumbotron class="smallJumbotron" header="{{header}} ({{iteration + 1}}/{{n_iterations}})" lead="{{hint_lead}}" header-level="4">
            {{hint}}
            <strong>{{note}}:</strong> {{note_text}}
        </b-jumbotron>
        {% endif %}

        <b-row align-h="center" class="mt-1 mb-1">
            <b-col class="text-center">
                <h5>Input</h5>
            </b-col>
          </b-row>
          <b-row align-h="center">
            <b-col align-h="center" class="text-center">
                <!-- <b-img src="{{emit_assets('visualrepresentation', filename='img/red.png')}}"/> -->
                {% if iteration_data['method'] == 'table-t' %}
                    <object type="text/html" style="width: 100%; text-align: center;" :data="data.example.rel_path"></object>
                {% else %}
                    <b-img :src="data.example.rel_path"/>
                {% endif %}
            </b-col>
          </b-row>
          <b-row align-h="center" class="mt-1 mb-1">
            <b-col class="text-center">
                <h5>
                    Classes
                </h5>
            </b-col>
          </b-row>
          {% if iteration_data['method'] == 'table-t' %}
          <b-row v-for="shown_class in data.shown_classes">
            <b-col align-h="center" class="text-center">
                <div :id="data.method + '_' + data.dataset + '_' + shown_class.name" style="z-index: 1;" @click="onSelectVisualization($event, shown_class)">
                  <object
                    style="width: 100%; height: auto; pointer-events: auto; position: relative; z-index: -1;" :data="shown_class.class_image_rel_path"
                  ></object>
                </div>
                  
                <!-- </div> -->
                
                <!-- <b-img :id="data.method + '_' + data.dataset + '_' + shown_class.name" @click="onSelectVisualization($event, shown_class)" :src="shown_class.class_image_rel_path"/> -->
            </b-col>
          </b-row>
          {% else %}
          <b-row>
            <b-col v-for="shown_class in data.shown_classes" align-h="center" class="text-center">
                <b-img :id="data.method + '_' + data.dataset + '_' + shown_class.name" @click="onSelectVisualization($event, shown_class)" :src="shown_class.class_image_rel_path"/>
            </b-col>
          </b-row>
          {% endif %}
          <b-row align-h="center" class="mt-5">
            <b-col cols="2">
                {% if iteration < n_iterations - 1 %}
                <b-form action="{{ continuation_url }}" method="GET">
                    <input type="hidden" hidden="true" :value="selectedItem.method" name="method"/>
                    <input type="hidden" hidden="true" :value="selectedItem.dataset" name="dataset"/>
                    <input type="hidden" hidden="true" :value="selectedItem.id" name="selection_id"/>
                    <input type="hidden" hidden="true" :value="selectedItem.className" name="class_name"/>
                    <input type="hidden" hidden="true" :value="selectedItem.example.name" name="example_name"/>
                    <input type="hidden" hidden="true" :value="selectedItem.example.example_class_name" name="example_class_name"/>
                    <b-btn type="submit" variant="primary" block :disabled="selectedItem.id == null">Continue</b-btn>
                </b-form>
                {% else %}
                <b-form action="{{ continuation_url }}" method="GET">
                    <input type="hidden" hidden="true" :value="selectedItem.method" name="method"/>
                    <input type="hidden" hidden="true" :value="selectedItem.dataset" name="dataset"/>
                    <input type="hidden" hidden="true" :value="selectedItem.id" name="selection_id"/>
                    <input type="hidden" hidden="true" :value="selectedItem.className" name="class_name"/>
                    <input type="hidden" hidden="true" :value="selectedItem.example.name" name="example_name"/>
                    <input type="hidden" hidden="true" :value="selectedItem.example.example_class_name" name="example_class_name"/>
                    <b-btn type="submit" variant="success" block :disabled="selectedItem.id == null">Finish</b-btn>
                </b-form>
                {% endif %}
            </b-col>
          </b-row>
      </b-container>
    </div>

    <script src="{{url_for('static', filename='interaction_reporting.js')}}"></script>

    <!-- Start running your app -->
    <script>
      var csrfToken = "{{csrf_token()}}";
      var data = JSON.parse('{{ iteration_data | tojson | safe}}');
      console.log(data);

      window.app = new Vue({
        el: '#app',
        delimiters: ['[[',']]'], // Used to replace double { escaping with double [ escaping (to prevent jinja vs vue inference)
        data: function() {
            return {
                selectedItem: {
                    className: null,
                    id: null,
                    dataset: data.dataset,
                    method: data.method,
                    example: data.example
                },
                data: data
            }
        },
        methods: {
            onSelectVisualization(event, shownClass) {
                //console.log("Selected visualization");
                //console.log(event.srcElement.id);
                //console.log(data.method, data.dataset, shownClass.name);

                let oldSelection = this.selectedItem;
                if (shownClass.name != oldSelection.className) {
                    event.srcElement.classList.add("selected");
                    if (oldSelection.id != null) {
                        document.getElementById(oldSelection.id).classList.remove("selected");
                    }
                }
                this.selectedItem.id = event.srcElement.id;
                this.selectedItem.className = shownClass.name;

                //reportSelectedItem(`/utils/selected-item`, csrfToken, item, this.selected, ()=>{ return {"variant": variant}; });
                reportOnInput("/utils/on-input", csrfToken, "visualization", {
                    "variant": this.selectedItem,
                    "old_variant": oldSelection
                    //"variant_name": this.variantNames[visualizationIndex],
                });
            }
        }
      })
    </script>
{% if footer_override is defined and footer_override is not none %}
<div class="footerDiv mt-3">
  {{ footer_override|safe }}
</div>
</body>
</html>
{% else %}
{% include 'footer.html' %}
{% endif %}